//sfSig:{"sig": "3046022100acf207139fdc9296b67ab08f35ec727442b6a69f22655f453d51a3df27449db6022100a3021e71aad432f275cd9c43679c9c4fa832e1aa0bac9483d8b37357159b99b8", "certPEM": "-----BEGIN CERTIFICATE-----$!$MIIDETCCAregAwIBAgIBATAKBggqhkjOPQQDAjBsMQswCQYDVQQGEwJVSzEfMB0G$!$A1UECgwWQ29uZmlndXJlZCBUaGluZ3MgTHRkLjENMAsGA1UECwwEY3R4ZDEOMAwG$!$A1UECwwFVXNlcnMxHTAbBgNVBAMMFGN0eGQtdXNlcnMtYWRtaW5zLWNhMB4XDTI0$!$MDgxNjE4MDkxN1oXDTM0MDgxNDE4MDkxN1owYDELMAkGA1UEBhMCVUsxHzAdBgNV$!$BAoMFkNvbmZpZ3VyZWQgVGhpbmdzIEx0ZC4xDTALBgNVBAsMBGN0eGQxDjAMBgNV$!$BAsMBVVzZXJzMREwDwYDVQQDDAhjdC1hZG1pbjBZMBMGByqGSM49AgEGCCqGSM49$!$AwEHA0IABAT8rSVBw5oFDMkdkfez3rM3Na8gSIb3SSlovkoA6T7J1vDueZyqrndI$!$aDbvQjKDYxT1p7DdsB7etGP3WDocEXOjggFUMIIBUDCBjgYIKwYBBQUHAQEEgYEw$!$fzBFBggrBgEFBQcwAoY5aHR0cDovL2N0eGQtdXNlcnMtYWRtaW5zLWNhLmN0eGQv$!$Y3R4ZC11c2Vycy1hZG1pbnMtY2EuY3J0MDYGCCsGAQUFBzABhipodHRwOi8vb2Nz$!$cC5jdHhkLXVzZXJzLWFkbWlucy1jYS5jdHhkOjkwODEwHwYDVR0jBBgwFoAUEu3Q$!$qtIP3h8krX5fHcLRiKhyIYIwDAYDVR0TAQH/BAIwADBKBgNVHR8EQzBBMD+gPaA7$!$hjlodHRwOi8vY3R4ZC11c2Vycy1hZG1pbnMtY2EuY3R4ZC9jdHhkLXVzZXJzLWFk$!$bWlucy1jYS5jcmwwEwYDVR0lBAwwCgYIKwYBBQUHAwIwDgYDVR0PAQH/BAQDAgeA$!$MB0GA1UdDgQWBBSqYd9d6yD2b9hzT37PD3ZoIe3D2DAKBggqhkjOPQQDAgNIADBF$!$AiEApvBDT8tEWIWefweWT1fcWZ/dt+jEUELDrxlZbqFrFE0CIHKsX7gB5bjq926w$!$SBRfgBLzqVIJl9m35EBBgmrSE5+3$!$-----END CERTIFICATE-----$!$", "description": "", "timestamp":"1755534333370", "timelimit":"0"}
//sfTimestamp:1755534333370
//sfLabel:/opt/ct/signing/files/Pipelines/ONVIF/high_import.sfjt
let
    SRC_DIR: env(CT_HOME) + '/src/',
    TEMPLATE_DIR: env(CT_HOME) + '/templates/',

    // Templates configured for this domain
    XD_RECEIVER:       require($TEMPLATE_DIR + 'XD_Receiver.sfjs'),
    XD_SENDER:         require($TEMPLATE_DIR + 'XD_Sender.sfjs'),
    WEB_PROXY_SERVER:  require($TEMPLATE_DIR + 'Web_Proxy_Server.sfjs'),

in
{

    Receiver: $XD_RECEIVER << {
        id: 'onvif_res',
        targets: {
            default: WebProxyServer,
        },
    },

    WebProxyServer: $WEB_PROXY_SERVER << {
        host: "import.high.ctxd",
        port: 8004,
        rewrite : [
            {match: "//$HOST:$PORT", replace: "//onvif-high:"+@port},
            {match: "//$HOST:", replace: "//onvif-high:"}
        ],
        targets: {
            default: Sender,
        },
    
    },

    Sender: $XD_SENDER << {
        id: 'onvif_req',
        messageKinds: ['request'],
    }

}
